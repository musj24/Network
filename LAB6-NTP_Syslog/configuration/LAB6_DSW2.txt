# [0] L3 스위치 기본 + STP Root(Secondary)
ip routing
spanning-tree mode rapid-pvst
spanning-tree vlan 1-4094 root secondary

# [1] 기본/백업 라우팅(Backup Default, AD 200)
ip route 0.0.0.0 0.0.0.0 192.168.150.1 200

# [2] DHCP Snooping 활성
ip dhcp snooping

# [3] ACL 정의(Distribution 정책)
ip access-list extended Allow_Ext_IN
permit udp any eq 68 any eq 67
permit udp any eq 67 any eq 68
permit ip any 10.0.0.0 0.255.255.255
permit ip any 172.16.0.0 0.15.0.0
permit ip any 192.168.0.0 0.0.255.255
permit ip 192.168.2.0 0.0.0.255 any
permit ip 192.168.3.0 0.0.0.255 any

# [4] VLAN 정의
vlan 10
 name HQ_10
vlan 20
 name HQ_20
vlan 30
 name HQ_30
vlan 99
 name native

# [5] L3 링크(DSW-DSW, DSW-HQ)
interface g1/0/1
 no switchport
 ip address 192.168.10.2 255.255.255.252

interface g1/0/2
 no switchport
 ip address 192.168.150.2 255.255.255.252
 ip ospf 1 area 0

# [6] Uplink EtherChannel(Trunk) + Snooping/DAI Trust
interface port-channel 1
 switchport mode trunk
 switchport trunk native vlan 99
 switchport trunk allowed vlan 10,20,30,99,50

interface range g1/0/3 - 4
 switchport mode trunk
 switchport trunk native vlan 99
 switchport trunk allowed vlan 10,20,30,99,50
 ip dhcp snooping vlan 10,20,30,50,99
 ip arp inspection vlan 10,20,30,50,99
 ip dhcp snooping trust
 ip arp inspection trust
 channel-group 1 mode active

interface port-channel 2
 switchport mode trunk
 switchport trunk native vlan 99
 switchport trunk allowed vlan 10,20,30,99,50

interface range g1/0/7 - 8
 switchport mode trunk
 switchport trunk native vlan 99
 switchport trunk allowed vlan 10,20,30,99,50
 ip dhcp snooping vlan 10,20,30,50,99
 ip arp inspection vlan 10,20,30,50,99
 ip dhcp snooping trust
 ip arp inspection trust
 channel-group 2 mode active

# [7] SVI + HSRP + ACL 적용
interface vlan 10
 ip address 192.168.1.3 255.255.255.0
 standby 10 ip 192.168.1.1
 standby 10 priority 100
 standby 10 preempt
 ip access-group Allow_Ext_IN in

interface vlan 20
 ip address 192.168.2.3 255.255.255.0
 standby 20 ip 192.168.2.1
 standby 20 priority 100
 standby 20 preempt
ip access-group Allow_Ext_IN in

interface vlan 30
 ip address 192.168.3.3 255.255.255.0
 standby 30 ip 192.168.3.1
 standby 30 priority 100
 standby 30 preempt
ip access-group Allow_Ext_IN in

interface vlan 99
ip address 192.168.99.11 255.255.255.0
standby 99 ip 192.168.99.254
standby 99 priority 100



# [8] OSPF
router ospf 1
 router-id 2.2.2.2
 network 192.168.1.0 0.0.0.255 area 0
 network 192.168.2.0 0.0.0.255 area 0
 network 192.168.3.0 0.0.0.255 area 0
 network 192.168.150.0 0.0.0.3 area 0
 network 192.168.10.0 0.0.0.3 area 0
 passive-interface default
 no passive-interface g1/0/1
 no passive-interface g1/0/2

# [9] int loopback (관리용)
int loopback 0
ip address 10.255.1.2 255.255.255.255

# [10] Syslog
service timestamps log datetime msec
logging on
logging host 192.168.50.4
logging trap debug

# [11] NTP
ntp server 192.168.50.4
clock timezone KST 9


